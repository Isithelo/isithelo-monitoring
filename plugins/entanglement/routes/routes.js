/*                                              
                                             .:'+#@#+':`                                            
                                       ,@@@@@@@@@@@@@@@@@@@@+.                                      
                                   .@@@@@@@@@@@@@@@@@@@@@@@@@@@@+                                   
                                `@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#                                
                              '@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.                             
                            #@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@:                           
                          +@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@,                         
                        ,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                        
                       @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#                      
                     :@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                     
                    @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@;                   
                   @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                  
                 `@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                 
                ,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                
               ;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@               
              ;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@              
             ,@@@@@@@@@@@@@@@@@    @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@+  :@@@@@@@@@@@@@@             
            `@@@@@@@@@@@@@@@@@.     @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@+    .@@@@@@@@@@@@@@            
            @@@@@@@@@@@@@@@@@@      @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@      @@@@@@@@@@@@@@@           
           @@@@@@@@@@@@@@@@@@@      @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@      @@@@@@@@@@@@@@@@          
          @@@@@@@@@@@@@@@@@@@@@    '@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'     @@@@@@@@@@@@@@@@,         
         :@@@@@@@@@@@@@@@@@@@@@@  #@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   `@@@@@@@@@@@@@@@@@@         
         @@@@@@@@@@@@@@@@@@@@@@@;'@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.,@@@@@@@@@@@@@@@@@@@@@@        
        @@@@@@@@@@@@@@@@@@@@@@@@;'@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@;       
       ,@@@@@@@@@@@@@@@@@@@@@@@@;'@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ #@@@@@@@@@@@@@@@@@@@@@@@@       
       @@@@@@@@@@@@@@@@@@@@@@@@@;'@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@      
      #@@@@@@@@@@@@@@@@@@@@@@@@@;;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@      
      @@@@@@@@@@@@@@@@@@@@@@@@@@;;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@' @@@@@@@@@@@@@@@@@@@@@@@@@@@@     
     @@@@@@@@@@@@@@@@@@@@@@@@@@@;;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@     
     @@@@@@@@@@@@@@@@@@@@@@@@@@@;;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.:@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@    
    +@@@@@@@@@@@@@@@@@@@@@@@@@@@;;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@    
    @@@@@@@@@@@@@@@@@@@@@@@@@@@@;;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ #@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   
   `@@@@@@@@@@@@@@@@@@@@@@@@@@@@;;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   
   @@@@@@@@@@@@@@@@@@@@@@@@@@@@@';@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.  
   @@@@@@@@@@@@@@@@@@@@@@@@@@@@@';@@@@@@@@@@@@@@@@@@@@@@@@@@@' @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
  .@@@@@@@@@@@@@@@@@@@@@@@@@@@@@';@@@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@';@@@@@@@@@@@@@@@@@@@@@@@@@@`:@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@. 
  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@':@@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ 
  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@':@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ 
 :@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@':@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ 
 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@':@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@`
 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@':@@@@@@@@@@@@@@@@@@@@@@@;`@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'
 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@':@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@',@@@@@@@@@@@@@@@@@@@@@@`;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@+,@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@+,@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@+,@@@@@@@@@@@@@@@@@@@@# @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
+@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@+:@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
#@@@@@@@@@@@@++@@@@@@@@@@@@@@@@@+,@@@@@@@@@@@@@@@@@@@:`@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
#@@@@@@@@@@@    @@@@@@@@@@@@@@@@+,@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   @@@@@@@@@
@@@@@@@@@@@      @@@@@@@@@@@@@@@+,@@@@@@@@@@@@@@@@@@ '@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@     @@@@@@@@
#@@@@@@@@@@      @@@@@@@@@@@@@@@+,@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#     '@@@@@@@
+@@@@@@@@@@      @@@@@@@@@@@@@@@+,@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@     ;@@@@@@@
'@@@@@@@@@@@    @@@@@@@@@@@@@@@@+.@@@@@@@@@@@@@@@@# @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#      @@@@@@@@
:@@@@@@@@@@@@#+@ @@@@@@@@@@@@@@@#.@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  @@   @@@@@@@@@
.@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@#.@@@@@@@@@@@@@@@,.@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@, #@@@@@@@@@@@@@@@
 @@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@#.@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@# ,@@@@@@@@@@@@@@@@@
 @@@@@@@@@@@@@@@@ +@@@@@@@@@@@@@#.@@@@@@@@@@@@@@ +@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  @@@@@@@@@@@@@@@@@@@
 @@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@#.@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@, #@@@@@@@@@@@@@@@@@@@@
 @@@@@@@@@@@@@@@@@.,@@@@@@@@@@@@#.@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@# ,@@@@@@@@@@@@@@@@@@@@@;
 #@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@#.@@@@@@@@@@@@+ @@@@@@@@@@@@@@@@@@@@@@@@@@  @@@@@@@@@@@@@@@@@@@@@@@ 
 .@@@@@@@@@@@@@@@@@' @@@@@@@@@@@#.@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@, #@@@@@@@@@@@@@@@@@@@@@@@@ 
  @@@@@@@@@@@@@@@@@@ @@@@@@@@@@@#.@@@@@@@@@@@,,@@@@@@@@@@@@@@@@@@@@@@@# .@@@@@@@@@@@@@@@@@@@@@@@@@@ 
  @@@@@@@@@@@@@@@@@@@ @@@@@@@@@@#.@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@  @@@@@@@@@@@@@@@@@@@@@@@@@@@+ 
  #@@@@@@@@@@@@@@@@@@ @@@@@@@@@@#`@@@@@@@@@@ +@@@@@@@@@@@@@@@@@@@@@, +@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
   @@@@@@@@@@@@@@@@@@@ @@@@@@@@@@`@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@# .@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
   @@@@@@@@@@@@@@@@@@@ '@@@@@@@@@`@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
   #@@@@@@@@@@@@@@@@@@@ @@@@@@@@@`@@@@@@@@+ @@@@@@@@@@@@@@@@@@: +@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   
    @@@@@@@@@@@@@@@@@@@,.@@@@@@@@`@@@@@@@@ @@@@@@@@@@@@@@@@@@ .@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   
    @@@@@@@@@@@@@@@@@@@@ @@@@@@@@`@@@@@@@.,@@@@@@@@@@@@@@@@  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'   
    .@@@@@@@@@@@@@@@@@@@+ @@@@@@@`@@@@@@@ @@@@@@@@@@@@@@@: +@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@    
     @@@@@@@@@@@@@@@@@@@@ @@@@@@@`@@@@@@ #@@@@@@@@@@@@@@ .@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@    
     :@@@@@@@@@@@@@@@@@@@@ @@@@@@`@@@@@@ @@@@@@@@@@@@@  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@     
      @@@@@@@@@@@@@@@@@@@@ #@@@@@`@@@@@ @@@@@@@@@@@@: +@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@     
      ,@@@@@@@@@@@@@@@@@@@@ @@@@@`@@@@' @@@@@@@@@@@ `@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@      
       @@@@@@@@@@@@@@@@@@@@`;@@@@ @@@@ @@@@@@@@@@  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'      
        @@@@@@@@@@@@@@@@@@@@ @@@@ @@@`:@@@@@@@@: '@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@       
        @@@@@@@@@@@@@@@@@@@@:.@@@ @@@ @@@@@@@@ `@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@        
         @@@@@@@@@@@@@@@@@@@@ @@@ @@ @@@@@@@  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@        
          @@@@@@@@@@@@@@@@@@@# @@ @@ @@@@@; '@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@         
          '@@@@@@@@@@@@@@@@@@@ @@ @ @@@@@ `@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@          
           @@@@@@@@@@@@@@@@@@@@ @ ;`@@@  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@#+@@@@@@@@@@@@@@@@@,          
            @@@@@@@@@@@@@@@@@@@     @; '@@@@@@@@@@@@@@@@@@@@@@@@@@@@@    @@@@@@@@@@@@@@@#           
             @@@@@@@@@@@@@@@@@@      `@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@      @@@@@@@@@@@@@@            
              @@@@@@@@@@@@@@@@@     `;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;      @@@@@@@@@@@@@             
               @@@@@@@@@@@@@@@@     :'''''''''''''''''''''''''''''''      @@@@@@@@@@@@              
                @@@@@@@@@@@@@@@;    @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@    @@@@@@@@@@@@               
                 @@@@@@@@@@@@@@@@'@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@++@@@@@@@@@@@@                
                  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#                 
                   @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@,                  
                    :@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                    
                      @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#                     
                       ;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@`                      
                         @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'                        
                           @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                          
                            `@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#                            
                               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'                              
                                 ,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                                 
                                    .@@@@@@@@@@@@@@@@@@@@@@@@@@+                                    
                                        `'@@@@@@@@@@@@@@@@@;                                        
                                    
      */
var express = require('express');
var path = require('path');
var logger = require('morgan');
var compression = require('compression');
var methodOverride = require('method-override');
var session = require('express-session');
var flash = require('express-flash');
var bodyParser = require('body-parser');
var expressValidator = require('express-validator');
var dotenv = require('dotenv');
var exphbs = require('express-handlebars');
var mongoose = require('mongoose');
var passport = require('passport');
var recaptcha = require('express-recaptcha');
var braintree = require("braintree");
var app = express.Router();

//set the plugin controller directory
var directory = '../../../plugins/entanglement/'

// Controllers
var createController = require(directory+'controllers/create'); 
var createScadaController = require(directory+'controllers/createscada'); 
var readController = require(directory+'controllers/read');
var readScadaController = require(directory+'controllers/readscada');

///////////////////////////   THESE ROUTES CAN BE REMOVED FOR CUSTOM SITES   ///////////////////////////
var entanglementController = require(directory+'controllers/entanglementpages'); 

///////////////////////////////////
////       COMPONENTS         //// 
/////////////////////////////////

app.get('/brief', entanglementController.brief);
app.get('/monitoring', entanglementController.monitoring); 
///////////////////////////   THESE ROUTES CAN BE REMOVED FOR CUSTOM SITES   ///////////////////////////
  
/////////////////////////////////////////
////       CREATE CONTROLLERS       //// 
///////////////////////////////////////
app.post('/entanglement/createform', createController.create);
 
////////////////////////////////////////////////
////       CREATE SCADAA CONTROLLERS       //// 
//////////////////////////////////////////////
app.post('/entanglement/createscada', createScadaController.create);

/////////////////////////////////////////
////       READ CONTROLLERS         //// 
///////////////////////////////////////
app.get('/entanglement/getprimer',   readController.getprimer);//get the primer form.
app.get('/entanglement/getraw',   readController.getraw);//get the raw form.
app.get('/entanglement/jstree', readController.jstree);//get jstree 
app.get('/entanglement/templateload', readController.templateload);//Load Template
app.get('/entanglement/templatename', readController.templatename);//get the select templatename
app.get('/entanglement/getdatacomp', readController.getdatacomp);//get data by array of ids.
app.get('/entanglement/getform',  readController.getform);//search for the form to load.
app.get('/entanglement/groups', readController.groups);//get the select groups

/////////////////////////////////////
////       READ SCADA DATA      //// 
///////////////////////////////////
app.get('/entanglement/getscada', readScadaController.getscada);


//last line
module.exports = app;