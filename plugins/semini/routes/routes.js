/*
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                             `,;++++';,                                             
                                        '@@@@@@@@@@@@@@@@@@@:                                       
                                    :@@@@@@@@@@@@@@@@@@@@@@@@@@@.                                   
                                 ,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                                 
                               '@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@,                              
                             #@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@,                            
                           ;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@`                          
                          @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                         
                        #@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@,                       
                       @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                      
                     ,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                     
                    +@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@`                   
                   @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@,                  
                  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@:                 
                 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@:                
                @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.               
               +@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@               
              ,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@              
              @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@             
             @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#            
            @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@+:,#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@            
            @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@;`          ;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@           
           @@@@@@@@@@@@@@@@@@@@@@@@@@@@@                 .@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#          
          '@@@@@@@@@@@@@@@@@@@@@@@@@@@                     `@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@          
          @@@@@@@@@@@@@@@@@@@@@@@@@@,                        ,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@         
         #@@@@@@@@@@@@@@@@@@@@@@@@@            ;:              ;@@@@@@@@@@@@@@@@@@@@@@@@@@@         
         @@@@@@@@@@@@@@@@@@@@@@@@@         `#@@@@@@@@@;          @@@@@@@@@@@@@@@@@@@@@@@@@@@        
        +@@@@@@@@@@@@@@@@@@@@@@@@       ,@@@@@@@@@@@@@@@@         @@@@@@@@@@@@@@@@@@@@@@@@@@        
        @@@@@@@@@@@@@@@@@@@@@@@@#      +@@@@@@@@@@@@@@@@@@@        @@@@@@@@@@@@@@@@@@@@@@@@@@       
       .@@@@@@@@@@@@@@@@@@@@@@@@      @@      @@@@@@@@@@@@@@@       @@@@@@@@@@@@@@@@@@@@@@@@@       
       @@@@@@@@@@@@@@@@@@@@@@@@#     @@        @@@@@@@@@@@@@@@;      @@@@@@@@@@@@@@@@@@@@@@@@:      
       @@@@@@@@@@@@@@@@@@@@@@@@     @@          @@@@@@@@@@@@@@@`     `@@@@@@@@@@@@@@@@@@@@@@@@      
      :@@@@@@@@@@@@@@@@@@@@@@@@     @           '@@@@@@@@@@@@@@@      :@@@@@@@@@@@@@@@@@@@@@@@      
      @@@@@@@@@@@@@@@@@@@@@@@@@     @           ,@@@@@@@@@@@@@@@@      @@@@@@@@@@@@@@@@@@@@@@@:     
      @@@@@@@@@@@@@@@@@@@@@@@@@     @            @@@@@@@@@@@@@@@@@      @@@@@@@@@@@@@@@@@@@@@@@     
      @@@@@@@@@@@@@@@@@@@@@@@@@     @            @@@@@@@@@@@@@@@@@'     @@@@@@@@@@@@@@@@@@@@@@@     
     '@@@@@@@@@@@@@@@@@@@@@@@@+    `@            @@@@@@@@@@@@@@@@@@`     @@@@@@@@@@@@@@@@@@@@@@     
     @@@@@@@@@@@@@@@@@@@@@@@@@@     @,           @@@@@@@@@@@@@@@@@@@     :@@@@@@@@@@@@@@@@@@@@@,    
     @@@@@@@@@@@@@@@@@@@@@@@@@@      @          '@@@@@@@@@@@@@@@@@@@      @@@@@@@@@@@@@@@@@@@@@#    
     @@@@@@@@@@@@@@@@@@@@@@@@@@@                @@@@@@@@@@@@@@@@@@@@@      @@@@@@@@@@@@@@@@@@@@@    
     @@@@@@@@@@@@@@@@@@@@@@@@@@@                @@@@@@@@@@@@@@@@@@@@@      @@@@@@@@@@@@@@@@@@@@@    
    `@@@@@@@@@@@@@@@@@@@@@@@@@@@:              @@@@@@@@@@@@@@@@@@@@@@.     @@@@@@@@@@@@@@@@@@@@@    
    ,@@@@@@@@@@@@@@@@@@@@@@@@@@@@#            @@@@@@@@@@@@@@@@@@@@@@@@     @@@@@@@@@@@@@@@@@@@@@    
    ;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@          +@@@@@@@@@@@@@@@@@@@@@@@@     @@@@@@@@@@@@@@@@@@@@@    
    '@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@+:.   :#@@@@@@@@@@@@@@@@@@@@@@@@@@'    @@@@@@@@@@@@@@@@@@@@@    
    @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@+    '@@@@@@@@@@@@@@@@@@@@    
    @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@+    ,@@@@@@@@@@@@@@@@@@@@    
    @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#     @@@@@@@@@@@@@@@@@@@@    
    '@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#     @@@@@@@@@@@@@@@@@@@@    
    ;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@     @@@@@@@@@@@@@@@@@@@@    
    ,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@     @@@@@@@@@@@@@@@@@@@@    
     @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@     @@@@@@@@@@@@@@@@@@@@    
     @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@     @@@@@@@@@@@@@@@@@@@@    
     @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@     @@@@@@@@@@@@@@@@@@@@    
     @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@     @@@@@@@@@@@@@@@@@@@'    
     @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@:     @@@@@@@@@@@@@@@@@@@`    
     :@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@      @@@@@@@@@@@@@@@@@@@     
      @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@      @@@@@@@@@@@@@@@@@@@     
      @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@      @@@@@@@@@@@@@@@@@@@     
      @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#      @@@@@@@@@@@@@@@@@@`     
      `@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.     '@@@@@@@@@@@@@@@@@@      
       @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@      @@@@@@@@@@@@@@@@@@@      
       @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@      @@@@@@@@@@@@@@@@@@`      
        @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@       @@@@@@@@@@@@@@@@@@       
        @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@      +@@@@@@@@@@@@@@@@@+       
        ,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.      @@@@@@@@@@@@@@@@@@        
         @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@      ,@@@@@@@@@@@@@@@@@@        
         ,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@:      @@@@@@@@@@@@@@@@@@         
          @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@       @@@@@@@@@@@@@@@@@#         
          `@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@+      @@@@@@@@@@@@@@@@@@          
           @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@       @@@@@@@@@@@@@@@@@,          
            @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@`      '@@@@@@@@@@@@@@@@@           
            ,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@       @@@@@@@@@@@@@@@@@            
             @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@       @@@@@@@@@@@@@@@@@.            
              @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@,      .@@@@@@@@@@@@@@@@@             
               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@       @@@@@@@@@@@@@@@@@              
               `@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@       @@@@@@@@@@@@@@@@@               
                ,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@`      `@@@@@@@@@@@@@@@@                
                 :@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@`       @@@@@@@@@@@@@@@@                 
                  :@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.       @@@@@@@@@@@@@@@@                  
                   ,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.       +@@@@@@@@@@@@@@@                   
                     @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.       ,@@@@@@@@@@@@@@@                    
                      @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.        @@@@@@@@@@@@@@#                     
                       #@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.        @@@@@@@@@@@@@@.                      
                        `@@@@@@@@@@@@@@@@@@@@@@@@@@@@:        @@@@@@@@@@@@@@                        
                          #@@@@@@@@@@@@@@@@@@@@@@@@@'        @@@@@@@@@@@@@,                         
                            @@@@@@@@@@@@@@@@@@@@@@@+        @@@@@@@@@@@@+                           
                              @@@@@@@@@@@@@@@@@@@@@        @@@@@@@@@@@#                             
                                @@@@@@@@@@@@@@@@@@        @@@@@@@@@@'                               
                                  :@@@@@@@@@@@@@@        #@@@@@@@@.                                 
                                     :@@@@@@@@@@        +@@@@@#.                                    
                                         ,#@@@@        '@@+.                                        
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    

      */
var express = require('express');
var path = require('path');
var logger = require('morgan');
var compression = require('compression');
var methodOverride = require('method-override');
var session = require('express-session');
var flash = require('express-flash');
var bodyParser = require('body-parser');
var expressValidator = require('express-validator');
var dotenv = require('dotenv');
var exphbs = require('express-handlebars');
var mongoose = require('mongoose');
var passport = require('passport');
var recaptcha = require('express-recaptcha');
var braintree = require("braintree");
var app = express.Router();

//set the plugin controller directory
var directory = '../../../plugins/semini/'

//Controllers
var creatController = require(directory+'controllers/create'); 
var readController = require(directory+'controllers/read');


///////////////////////////   THESE ROUTES CAN BE REMOVED FOR CUSTOM SITES   ///////////////////////////
var seminiController = require(directory+'controllers/seminipages'); 


/////////////////////////////////
////       TEMPALTES        //// 
///////////////////////////////
app.get('/forms', seminiController.forms);
 
 
///////////////////////////   THESE ROUTES CAN BE REMOVED FOR CUSTOM SITES   ///////////////////////////
 
/////////////////////////////////////////
////       CREATE CONTROLLERS       //// 
///////////////////////////////////////
app.post('/forms/createform', creatController.createform);
app.get('/forms/getdata', readController.getdata);//get data by array of ids.

/////////////////////////////////////////
////       READ CONTROLLERS         //// 
///////////////////////////////////////
app.get('/forms/getprimer',   readController.getprimer);//get the primer form.
app.get('/forms/getraw',   readController.getraw);//get the raw form.
app.get('/forms/jstree', readController.jstree);//get jstree 
app.get('/forms/templateload', readController.templateload);//Load Template
app.get('/forms/templatename', readController.templatename);//get the select templatename
app.get('/forms/getdatacomp', readController.getdatacomp);//get data by array of ids.
app.get('/forms/getform',  readController.getform);//search for the form to load.
app.get('/forms/groups', readController.groups);//get the select groups

//last line
module.exports = app;